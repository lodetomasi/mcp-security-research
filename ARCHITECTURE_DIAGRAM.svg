<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="800" fill="#ffffff"/>

  <!-- Title -->
  <text x="600" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50" text-anchor="middle">
    MCP Exploit Chain Architecture
  </text>

  <!-- Defs for arrows and shadows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c" />
    </marker>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#3498db" />
    </marker>
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- ATTACKER (Top Left) -->
  <rect x="50" y="100" width="200" height="100" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="8" filter="url(#shadow)"/>
  <text x="150" y="135" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Attacker Server
  </text>
  <text x="150" y="160" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    attacker.com
  </text>
  <text x="150" y="180" font-family="Arial, sans-serif" font-size="11" fill="#ffffff" text-anchor="middle">
    Malicious HTML + Payloads
  </text>

  <!-- USER (Top Right) -->
  <rect x="950" y="100" width="200" height="100" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="8" filter="url(#shadow)"/>
  <text x="1050" y="135" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    User
  </text>
  <text x="1050" y="160" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    Claude Desktop
  </text>
  <text x="1050" y="180" font-family="Arial, sans-serif" font-size="11" fill="#ffffff" text-anchor="middle">
    "Fetch docs from..."
  </text>

  <!-- Step 1: AI Agent -->
  <rect x="450" y="100" width="300" height="100" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2" rx="8" filter="url(#shadow)"/>
  <text x="600" y="125" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    STEP 1
  </text>
  <text x="600" y="150" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    AI Agent (Claude)
  </text>
  <text x="600" y="175" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    Processes user request
  </text>

  <!-- Step 2: Fetch Server -->
  <rect x="50" y="280" width="300" height="120" fill="#e67e22" stroke="#d35400" stroke-width="2" rx="8" filter="url(#shadow)"/>
  <text x="200" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    STEP 2
  </text>
  <text x="200" y="330" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    MCP Fetch Server
  </text>
  <text x="200" y="355" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    @modelcontextprotocol/server-fetch
  </text>
  <text x="200" y="380" font-family="Arial, sans-serif" font-size="11" fill="#ffffff" text-anchor="middle">
    ❌ No URL validation
  </text>

  <!-- Step 3: Content Processing -->
  <rect x="450" y="280" width="300" height="120" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="8" filter="url(#shadow)"/>
  <text x="600" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    STEP 3
  </text>
  <text x="600" y="330" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Content Processing
  </text>
  <text x="600" y="355" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    markdownify preserves comments
  </text>
  <text x="600" y="380" font-family="Arial, sans-serif" font-size="11" fill="#ffffff" text-anchor="middle">
    ❌ No sanitization
  </text>

  <!-- Step 4: Filesystem Server -->
  <rect x="850" y="280" width="300" height="120" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="8" filter="url(#shadow)"/>
  <text x="1000" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    STEP 4
  </text>
  <text x="1000" y="330" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">
    MCP Filesystem Server
  </text>
  <text x="1000" y="355" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    @modelcontextprotocol/server-filesystem
  </text>
  <text x="1000" y="380" font-family="Arial, sans-serif" font-size="11" fill="#ffffff" text-anchor="middle">
    ❌ No user approval
  </text>

  <!-- Step 5: System Compromise -->
  <rect x="450" y="480" width="300" height="100" fill="#c0392b" stroke="#922b21" stroke-width="3" rx="8" filter="url(#shadow)"/>
  <text x="600" y="515" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    STEP 5
  </text>
  <text x="600" y="545" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#ffffff" text-anchor="middle">
    SYSTEM COMPROMISED
  </text>
  <text x="600" y="570" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">
    Remote Code Execution
  </text>

  <!-- Arrows -->
  <!-- User to AI Agent -->
  <line x1="950" y1="150" x2="750" y2="150" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
  <text x="850" y="140" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    Prompt
  </text>

  <!-- AI Agent to Fetch Server -->
  <line x1="550" y1="200" x2="250" y2="280" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="380" y="230" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    fetch(url)
  </text>

  <!-- Fetch Server to Attacker -->
  <line x1="150" y1="200" x2="150" y2="280" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="160" y="240" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    HTTP GET
  </text>

  <!-- Attacker to Fetch Server (response) -->
  <line x1="200" y1="200" x2="200" y2="280" stroke="#e74c3c" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="210" y="240" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    Malicious HTML
  </text>

  <!-- Fetch Server to Content Processing -->
  <line x1="350" y1="340" x2="450" y2="340" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="390" y="330" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    HTML
  </text>

  <!-- Content Processing to Filesystem Server -->
  <line x1="750" y1="340" x2="850" y2="340" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="790" y="330" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    Commands
  </text>

  <!-- Filesystem Server to System Compromise -->
  <line x1="1000" y1="400" x2="675" y2="480" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="820" y="430" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    Execute
  </text>

  <!-- Vulnerability Labels -->
  <rect x="50" y="650" width="350" height="120" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="6"/>
  <text x="225" y="680" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50" text-anchor="middle">
    Vulnerabilities
  </text>
  <text x="70" y="705" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    • CWE-918: SSRF (Step 2)
  </text>
  <text x="70" y="725" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    • CWE-79: HTML Injection (Step 3)
  </text>
  <text x="70" y="745" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    • CWE-862: Missing Authorization (Step 4)
  </text>

  <!-- Impact -->
  <rect x="450" y="650" width="350" height="120" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="6"/>
  <text x="625" y="680" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50" text-anchor="middle">
    Impact
  </text>
  <text x="470" y="705" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    • AWS Credential Theft
  </text>
  <text x="470" y="725" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    • Arbitrary File Write
  </text>
  <text x="470" y="745" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    • Remote Code Execution
  </text>

  <!-- CVSS Score -->
  <rect x="850" y="650" width="300" height="120" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="6"/>
  <text x="1000" y="680" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Severity
  </text>
  <text x="1000" y="715" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#ffffff" text-anchor="middle">
    CVSS 8.6
  </text>
  <text x="1000" y="750" font-family="Arial, sans-serif" font-size="16" fill="#ffffff" text-anchor="middle">
    HIGH
  </text>
</svg>
